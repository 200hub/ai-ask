<!DOCTYPE html>
<html lang="en">
<head>
    <title>Injection Script Test</title>
</head>
<body>
    <h1>Test Page</h1>
    <textarea id="prompt-textarea" placeholder="Enter text here"></textarea>
    <button data-testid="send-button">Send</button>
    
    <h2>Console Output:</h2>
    <div id="output" style="font-family: monospace; white-space: pre-wrap; border: 1px solid #ccc; padding: 10px; margin-top: 10px;"></div>

    <script>
        // Intercept console.log
        const output = document.getElementById('output');
        const originalLog = console.log;
        const originalError = console.error;
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            output.textContent += args.join(' ') + '\n';
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            output.textContent += 'ERROR: ' + args.join(' ') + '\n';
        };

        // The EXACT generated script from logs
        (async function() {
            console.log('[INJECTION] Script execution started');
            
            try {
                const __result = await (async function() {
                    const startTime = Date.now();
                    const results = [];

                    try {
                        // Action 1: fill
                        await ((function() {
                            return new Promise((resolve, reject) => {
                                const startTime = Date.now();
                                const timeout = 5000;
                                
                                console.log('[FINDER] Looking for element: #prompt-textarea');
                                
                                function findElement() {
                                    try {
                                        let element = null;
                                        let context = document;
                                        
                                        element = context.querySelector('#prompt-textarea');
                                        
                                        if (element) {
                                            console.log('[FINDER] Element found:', element);
                                            resolve(element);
                                        } else {
                                            const elapsed = Date.now() - startTime;
                                            if (elapsed > timeout) {
                                                console.error('[FINDER] Timeout after ' + elapsed + 'ms');
                                                reject(new Error('Element not found'));
                                            } else {
                                                setTimeout(findElement, 100);
                                            }
                                        }
                                    } catch (error) {
                                        reject(error);
                                    }
                                }
                                
                                findElement();
                            });
                        })();).then(element => {
                            console.log('[FILL] Filling element:', element.tagName);
                            
                            const valueToSet = '111';
                            element.value = valueToSet;
                            element.focus();
                            
                            console.log('[FILL] Fill completed successfully');
                            return { success: true };
                        })
                        
                        // Action 2: wait
                        await new Promise(resolve => {
                            setTimeout(() => {
                                console.log('[WAIT] Wait completed');
                                resolve({ success: true });
                            }, 300);
                        });
                        
                        // Action 3: click
                        await ((function() {
                            return new Promise((resolve, reject) => {
                                console.log('[FINDER] Looking for element: button[data-testid="send-button"]');
                                const element = document.querySelector('button[data-testid="send-button"]');
                                if (element) {
                                    console.log('[FINDER] Element found:', element);
                                    resolve(element);
                                } else {
                                    reject(new Error('Button not found'));
                                }
                            });
                        })();).then(element => {
                            console.log('[CLICK] Clicking element:', element.tagName);
                            element.click();
                            console.log('[CLICK] Click completed');
                            return { success: true };
                        });
                        
                        return {
                            success: true,
                            duration: Date.now() - startTime,
                            actionsExecuted: 3
                        };
                    } catch (error) {
                        return {
                            success: false,
                            error: error.message || String(error)
                        };
                    }
                })();
                
                console.log('[INJECTION] Script completed successfully, result:', __result);
            } catch (error) {
                console.error('[INJECTION] Script error:', error);
            }
        })();

        // Listen for click
        document.querySelector('button[data-testid="send-button"]').addEventListener('click', () => {
            console.log('[BUTTON] Button was clicked! Textarea value:', document.getElementById('prompt-textarea').value);
        });
    </script>
</body>
</html>
